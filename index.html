<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Calculadora De Nigris</title>
  <link rel="icon" type="image/png" href="Imagens/icon.png"/>
  <link rel="stylesheet" href="style.css">
  
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
</head>

<body>

  <div id="loading" class="loading-overlay">
    <div class="loading-spinner"></div>
    <p>Carregando dados...</p>
  </div>

  <header class="main-header">
    <div class="header-container">
      <div class="logo-area">
        <a href="home.html" class="logo-link">
          <img src="Imagens/Mercedes-Logo.png" alt="Mercedes-Benz Logo" class="brand-logo">
          <span class="divider-vertical"></span>
          <img src="Imagens/Logo_De Nigris Branco.png" alt="De Nigris Logo" class="dealer-logo">
        </a>
      </div>

      <button class="nav-toggle" aria-label="Menu">
        <span class="bar"></span>
        <span class="bar"></span>
        <span class="bar"></span>
      </button>

      <nav class="nav-menu">
        <a href="home.html" class="nav-item">Home</a>
        <a href="index.html" class="nav-item active">Calculadora</a>
        <a href="estoque.html" class="nav-item">Estoque</a>
      </nav>
    </div>
  </header>
  
  <div class="header-space"></div>

  <main id="mainContent" class="main-wrapper">

    <div class="tabs-container">
      <button id="btnEstoqueProprio" class="tab-btn active">Estoque De Nigris</button>
      <button id="btnEstoqueFabrica" class="tab-btn">Tabela de Pre√ßos</button>
    </div>

    <section id="calcEstoqueProprio" class="calc-section">
      <div class="container-width">
        
        <div class="card glass-effect">
          <div class="card-header">
            <h2>Calculadora De Nigris</h2>
            <span class="status-badge">Pronta Entrega</span>
          </div>

          <div class="card-body">
            
          <div class="vehicle-dashboard">
            <div class="vehicle-info">
              <div class="info-item">
                <span class="info-label">Modelo</span>
                <strong id="modelo" class="info-value">‚Äì</strong>
              </div>
              <div class="info-item">
                <span class="info-label">UP</span>
                <strong id="up" class="info-value">‚Äì</strong>
              </div>
              <div class="info-item">
                <span class="info-label">Ano/Mod</span>
                <strong id="anoMod" class="info-value">‚Äì</strong>
              </div>
            </div>

            <div id="obs-container" style="display: none; margin: 10px 0; text-align: center; color: #d9534f; font-size: 0.9rem;">
                <strong>Observa√ß√£o: </strong> <span id="obs-texto"></span>
            </div>
            <div class="fz-wrapper">
              <label for="fz" class="input-label">FZ / Chassi</label>
              <div class="input-group">
                <input type="text" id="fz" class="form-input" maxlength="6" placeholder="Ex: 123456"/>
                <span class="input-icon">üîç</span>
              </div>
              <div id="fzError" class="error-msg"></div>
            </div>
              
              <div class="action-buttons-mini">
                <button type="button" id="btnVerFoto" class="btn-icon" class="btn-icon photo" title="Ver foto">
                  <svg viewBox="0 0 24 24" aria-hidden="true">
                    <path d="M21 5h-3.2l-1.8-2H8L6.2 5H3c-1.1 0-2 .9-2 2v11c0 1.1.9 2 2 2h18c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm-9 13a4 4 0 1 1 0-8 4 4 0 0 1 0 8z"/>
                  </svg>
                </button>

                <button type="button" id="btnVerInfo" class="btn-icon" class="btn-icon info" title="Mais informa√ß√µes">
                  <svg viewBox="0 0 24 24" aria-hidden="true">
                    <path d="M11 7h2V9h-2zm0 4h2v6h-2zm1-9C6.93 2 3 5.93 3 11s3.93 9 9 9 9-3.93 9-9-3.93-9-9-9z"/>
                  </svg>
                </button>
              </div>

              <div class="price-hero">
                <span class="label">Valor de Tabela</span>
                <strong id="valorTabela" class="hero-value">R$ 0,00</strong>
              </div>
            </div>

            <hr class="divider">

            <div class="form-section">
              <div class="form-section"> <div class="form-group full-width">
                  <label for="tipoPreco">Tabela de Pre√ßo</label>
                  <div class="select-wrapper">
                    <select id="tipoPreco" class="form-select">
                      <option value="vendedor">Vendedor</option>
                      <option value="gerente">Gerente</option>
                      <option value="oportunidade">Oportunidade</option>
                      <option value="especial">Especial (Manual)</option>
                    </select>
                  </div>
                </div>

                <div id="especialWrapper" class="hidden">
                  <label for="precoEspecial">Valor Negociado</label>
                  <div class="input-money-group">
                    <span class="currency-symbol">R$</span>
                    <input type="text" inputmode="decimal" id="precoEspecial" placeholder="0,00" />
                  </div>
                  <span id="minEspecialValor">M√≠nimo sugerido: R$ --</span>
                </div>
              </div>

              <div id="infoVeiculo" class="vehicle-details hidden">
                <ul class="details-list">
                  <li><strong>Cor:</strong> <span id="infoCor">‚Äì</span></li>
                  <li><strong>Variante:</strong> <span id="infoVariante">‚Äì</span></li>
                  <li><strong>P√°tio:</strong> <span id="infoPatio">‚Äì</span></li>
                </ul>
              </div>
            </div>

            <div class="results-container">
              <div class="result-row">
                <span class="result-label">Desconto Aplicado</span>
                <span id="descontoReais" class="result-value discount">R$ 0,00</span>
              </div>
              <div class="result-row highlight">
                <span class="result-label">Valor de Venda</span>
                <span id="valorVenda" class="result-value final">R$ 0,00</span>
              </div>

              <div class="protected-data">
                <div class="row hidden" id="rowComissaoProtected">
                  <span>Comiss√£o</span> <span id="comissaoProtected">R$ 0,00</span>
                </div>
                <div class="row hidden" id="rowDsrProtected">
                  <span>DSR ~</span> <span id="dsrProtected">R$ 0,00</span>
                </div>
                <div class="row hidden" id="rowTotalProtected">
                  <span>Total</span> <span id="total">R$ 0,00</span>
                </div>
              </div>
            </div>

            <button id="btnMostrarProtegido" class="btn-premium btn-detail">
              <span class="icon"></span> Ver Detalhamento
            </button>

            <div id="passwordGroup" class="password-wrapper hidden">
              <div class="password-box">
                <input type="password" id="senhaInput" placeholder="Senha do Gestor" />
                <button id="btnVerificarSenha">OK</button>
              </div>
              <div id="senhaError" class="error-msg"></div>
            </div>

            <div class="action-footer">
              <a id="linkEmitirPedido" href="https://gd.cimbb.com.br/p/crm/atividades/agenda/" target="_blank" class="btn-premium btn-order">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="margin-right: 8px;"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path><polyline points="14 2 14 8 20 8"></polyline><line x1="16" y1="13" x2="8" y2="13"></line><line x1="16" y1="17" x2="8" y2="17"></line><polyline points="10 9 9 9 8 9"></polyline></svg>
                Emitir Pedido
              </a>

              <button type="button" id="btnOpenReserva" class="btn-premium btn-whatsapp">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="margin-right: 8px;"><path d="M21 11.5a8.38 8.38 0 0 1-.9 3.8 8.5 8.5 0 0 1-7.6 4.7 8.38 8.38 0 0 1-3.8-.9L3 21l1.9-5.7a8.38 8.38 0 0 1-.9-3.8 8.5 8.5 0 0 1 4.7-7.6 8.38 8.38 0 0 1 3.8-.9h.5a8.48 8.48 0 0 1 8 8v.5z"></path></svg>
                Solicitar Reserva
              </button>

            <div id="modalReserva" class="modal-overlay hidden">
              <div class="modal-card">
                <div class="modal-header">
                  <h3>Solicita√ß√£o de Reserva</h3>
                  <button class="btn-close-modal" id="btnCloseReserva">√ó</button>
                </div>
                
              <div class="modal-body" style="max-height: 70vh; overflow-y: auto; padding-right: 5px;">
                  <p class="modal-subtitle">Confirme os dados para enviar a solicita√ß√£o.</p>
                  
                  <div class="reserva-summary">
                    <span id="resumoModelo">Modelo: --</span>
                    <span id="resumoFZ">FZ: --</span>
                  </div>

                  <div class="form-group">
                    <label>Nome do Vendedor</label>
                    <input type="text" id="reservaNome" class="form-input" placeholder="Seu nome">
                  </div>

                  <div class="form-grid-2" style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px;">
                    <div class="form-group">
                      <label>Pedido / Proposta</label>
                      <input type="text" id="reservaPedido" class="form-input" placeholder="Ex: 12345">
                    </div>
                    <div class="form-group">
                      <label>Concession√°ria</label>
                      <div class="select-wrapper">
                        <select id="reservaLoja" class="form-select">
                          <option value="">Selecione...</option>
                          <option value="Lim√£o">Lim√£o</option>
                          <option value="SBC">SBC</option>
                          <option value="Sorocaba">Sorocaba</option>
                          <option value="Itu">Itu</option>
                          <option value="SJC">SJC</option>
                        </select>
                      </div>
                    </div>
                  </div>

                  <hr style="margin: 15px 0; border: 0; border-top: 1px dashed #cbd5e1;">

                  <div class="form-group">
                    <label>Cliente</label>
                    <input type="text" id="reservaCliente" class="form-input" placeholder="Nome da Empresa ou PF">
                  </div>

                  <div class="form-grid-2" style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px;">
                    <div class="form-group">
                      <label>Term√¥metro</label>
                      <div class="select-wrapper">
                        <select id="reservaTermometro" class="form-select">
                          <option value="Quente">Quente</option>
                          <option value="Morno">Morno</option>
                          <option value="Frio">Frio</option>
                        </select>
                      </div>
                    </div>
                    <div class="form-group">
                      <label>Dt Prev. Fat.</label>
                      <input type="date" id="reservaDataFaturamento" class="form-input">
                    </div>
                  </div>

                  <div class="form-group">
                    <label>Forma de Pagamento</label>
                    <div class="select-wrapper">
                      <select id="reservaFormaPagamento" class="form-select">
                        <option value="A VISTA">A VISTA</option>
                        <option value="LEASING">LEASING</option>
                        <option value="CDC">CDC</option>
                        <option value="CONSORCIO">CONS√ìRCIO</option>
                        <option value="BNDES">BNDES</option>
                        <option value="PARCELADO DE NIGRIS">PARCELADO DE NIGRIS</option>
                      </select>
                    </div>
                  </div>

                  <div class="form-group">
                    <label>Institui√ß√£o Financeira</label>
                    <div class="select-wrapper">
                      <select id="reservaInstituicao" class="form-select">
                        <option value="Nenhuma">Selecione...</option>
                        <optgroup label="--- A VISTA ---">
                          <option>Dinheiro</option>
                          <option>Boleto at√© 7 dias</option>
                          <option>PIX</option>
                          <option>Cart√£o de Cr√©dito A Vista</option>
                          <option>Cart√£o de Cr√©dito Parcelado at√© 3x</option>
                          <option>Cart√£o de Cr√©dito Parcelado at√© 6x</option>
                        </optgroup>
                        <optgroup label="--- BANCOS / FINANCIADORAS ---">
                          <option>Banco Mercedes-Benz</option>
                          <option>Banco do Brasil</option>
                          <option>Bradesco Financiamentos</option>
                          <option>Ita√∫ Card</option>
                          <option>Santander</option>
                          <option>Banco Safra</option>
                          <option>Banco BV</option>
                          <option>Banco Daycoval</option>
                          <option>Banco PAN</option>
                          <option>Sicoob</option>
                          <option>Sicredi</option>
                          <option>Banco Alfa</option>
                          <option>Banco Sofisa</option>
                        </optgroup>
                        <optgroup label="--- CONS√ìRCIOS ---">
                          <option>Cons√≥rcio Mercabenco</option>
                          <option>Cons√≥rcio Mercedes-Benz</option>
                          <option>Rodobens</option>
                          <option>Embracon</option>
                          <option>Cons√≥rcio Maggi</option>
                          <option>Porto Seguro</option>
                          <option>Bradesco Cons√≥rcios</option>
                          <option>Ita√∫ Cons√≥rcios</option>
                          <option>BB Cons√≥rcios</option>
                          <option>Ademicon</option>
                          <option>Mapfre</option>
                          <option>Sicoob Cons√≥rcios</option>
                          <option>Canopus</option>
                          <option>Servopa</option>
                          <option>Unifisa</option>
                        </optgroup>
                      </select>
                    </div>
                  </div>

                  <div style="display: flex; flex-direction: column; gap: 10px; margin-top: 15px; background: #f8fafc; padding: 12px; border-radius: 8px; border: 1px solid #e2e8f0;">
                    <label style="display: flex; align-items: center; gap: 8px; font-weight: 600; font-size: 0.9rem; color: #15803d; cursor: pointer;">
                      <input type="checkbox" id="reservaCredito" style="width: 18px; height: 18px;"> ( ) Sim, Cr√©dito Aprovado
                    </label>
                    <label style="display: flex; align-items: center; gap: 8px; font-weight: 500; font-size: 0.9rem; cursor: pointer;">
                      <input type="checkbox" id="reservaEntrada" style="width: 16px; height: 16px;"> Pagar entrada?
                    </label>
                    <label style="display: flex; align-items: center; gap: 8px; font-weight: 500; font-size: 0.9rem; cursor: pointer;">
                      <input type="checkbox" id="reservaTroca" style="width: 16px; height: 16px;"> Semi Novo na troca?
                    </label>
                    <label style="display: flex; align-items: center; gap: 8px; font-weight: 500; font-size: 0.9rem; cursor: pointer;">
                      <input type="checkbox" id="reservaParceria" style="width: 16px; height: 16px;"> Venda em parceria?
                    </label>
                    
                    <div id="boxNomeParceiro" style="display: none; padding-left: 24px; margin-top: -4px;">
                      <input type="text" id="nomeParceiro" class="form-input" placeholder="Nome do vendedor parceiro" style="padding: 8px; font-size: 0.85rem;">
                    </div>
                  </div>

                  <button id="btnEnviarWhatsApp" class="btn-premium btn-primary full-width" style="margin-top: 20px;">
                    Enviar no WhatsApp
                  </button>
                </div>
              </div>
            </div>

          </div> </div> </div>
    </section>

    <section id="calcEstoqueFabrica" class="calc-section hidden fabrica-theme">
      <div class="container-width">
        <div class="card">
          <div class="card-header factory">
            <h2>Tabela de Pre√ßos</h2>
            <span class="status-badge gray">Simula√ß√£o</span>
          </div>
          
          <div class="card-body">
            
            <div class="form-grid">
              <div class="form-group">
                <label for="anoModeloFab">Ano/Modelo</label>
                <div class="select-wrapper">
                  <select id="anoModeloFab" class="form-select">
                    <option value="">Selecione</option>
                    <option value="25/25">25/25</option>
                    <option value="25/26">25/26</option>
                    <option value="26/26">26/26</option>
                  </select>
                </div>
              </div>

              <div class="form-group full-width">
                <label>Fam√≠lia</label>
                <div id="familiaFab" class="radio-group-modern">
                  <label class="radio-btn"><input type="radio" name="familiaFab" value="Accelo"><span>Accelo</span></label>
                  <label class="radio-btn"><input type="radio" name="familiaFab" value="Atego"><span>Atego</span></label>
                  <label class="radio-btn"><input type="radio" name="familiaFab" value="Actros"><span>Actros</span></label>
                  <label class="radio-btn"><input type="radio" name="familiaFab" value="Axor"><span>Axor</span></label>
                  <label class="radio-btn"><input type="radio" name="familiaFab" value="Arocs"><span>Arocs</span></label>
                </div>
              </div>

              <div class="form-group">
                <label for="upFab">UP</label>
                <div class="select-wrapper">
                  <select id="upFab" class="form-select"></select>
                </div>
              </div>

              <div class="form-group">
                 <label>Variante</label>
                 <div class="variant-display-box">
                    <div id="varianteFab" class="variant-text">--</div>
                    <button id="btnCopiarVariante" class="btn-copy" title="Copiar">
                      <svg id="iconCopiarVariante" width="16" height="16" fill="currentColor" viewBox="0 0 16 16"><path d="M10 1.5A1.5 1.5 0 0 1 11.5 3v1h-1V3a.5.5 0 0 0-.5-.5h-7A.5.5 0 0 0 2 3v10a.5.5 0 0 0 .5.5H6v1H2.5A1.5 1.5 0 0 1 1 13.5v-10A1.5 1.5 0 0 1 2.5 2h7zm1 3A1.5 1.5 0 0 1 12.5 6v7A1.5 1.5 0 0 1 11 14.5h-5A1.5 1.5 0 0 1 4.5 13V6A1.5 1.5 0 0 1 6 4.5h5zm-5 1A.5.5 0 0 0 6 6v7a.5.5 0 0 0 .5.5h5a.5.5 0 0 0 .5-.5V6a.5.5 0 0 0-.5-.5h-5z"/></svg>
                      <svg id="iconCheckVariante" width="16" height="16" fill="currentColor" viewBox="0 0 16 16" style="display:none;"><path d="M13.485 1.929a1 1 0 0 1 1.415 1.414l-8 8a1 1 0 0 1-1.415 0l-4-4A1 1 0 1 1 2.9 5.929l3.293 3.293 7.293-7.293z"/></svg>
                    </button>
                 </div>
              </div>

                <div class="form-group full-width model-wrapper">
                  <label for="modeloFab">Descri√ß√£o Comercial</label>
                  
                  <div class="input-with-action">
                    <div class="select-wrapper">
                      <select id="modeloFab" class="form-select">
                        </select>
                    </div>
                    
                    <a href="https://truckinfomb.com.br/variantes" target="_blank" class="truck-link" title="Ver no TruckInfo">
                      <img src="Imagens/truckinfo.png" alt="Truck Info">
                    </a>
                  </div>
                </div>
                  <div class="form-group full-width">

                    <label for="acaoFab">Condi√ß√£o Comercial</label>

                    <div class="select-wrapper">

                      <select id="acaoFab" class="form-select">

                        <option value="">Selecione a Campanha</option>

                        <option value="Estoque">Estoque</option>

                        <option value="C.E.ABAST">C.E.ABAST</option>

                        <option value="Frigorificado">Frigorificado</option>

                        <option value="Postos de Combustiveis">Postos de Combustiveis</option>

                        <option value="Mais Alimentos">Mais Alimentos</option>

                      </select>

                    </div>

                  </div>
                    </div>
            </div>
              <div class="result-card-factory">
                <div class="result-grid">
                  <div class="result-item">
                    <span class="label">Valor Tabela</span>
                    <span id="faValorTabela" class="value">R$ 0,00</span>
                  </div>
                  <div class="result-item highlight">
                    <span class="label">Valor Venda</span>
                    <span id="faValorVenda" class="value">R$ 0,00</span>
                  </div>
                  <div class="result-item">
                    <span class="label">Desconto</span>
                    <span id="faDescontoPerc" class="value discount">0%</span>
                  </div>
                </div>
                <button id="btnDetalhamentoFab" class="btn-outline-secondary full-width mt-3">
                  Ver Detalhamento Completo
                </button>
              </div>

            </div></div></div>
    </section>

  </main>

  <script type="module">
    import { requireAuth } from './auth.js'
    await requireAuth('estoque.html')
  </script>
  
  <script src="script.js"></script>

</body>
</html>