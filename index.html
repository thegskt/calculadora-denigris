<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Calculadora De Nigris</title>
  <link
    href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&display=swap"
    rel="stylesheet"/>
  <style>
    :root {
      --primary: #23408e;
      --accent: #2768c9e0;
      --error: #c0392b;
      --bg: #f7f9fb;
      --card: #fff;
      --text: #222;
      --muted: #7a7a7a;
      --border: #e0e4ea;
      --shadow: 0 4px 24px 0 rgba(35,64,142,0.07);
      --radius: 12px;
    }
    * { box-sizing: border-box; }
    body {
      margin: 0; padding: 0;
      font-family: 'Inter', sans-serif;
      background: var(--bg);
      color: var(--text);
      min-height: 100vh;
      display: flex;
      justify-content: center;
      align-items: flex-start;
    }
    .hidden { display: none !important; }

    /* Container geral */
    .container {
      width: 100%; max-width: 480px;
      margin: 2.5rem auto;
      background: var(--card);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      overflow: hidden;
      border: 1px solid var(--border);
    }
    .header {
      background: linear-gradient(90deg, var(--primary) 70%, var(--accent) 100%);
      padding: 1.5rem 1rem;
      color: #fff;
      text-align: center;
      font-size: 2rem;
      font-weight: 700;
      letter-spacing: 1px;
      border-bottom: 1px solid var(--border);
      box-shadow: 0 2px 12px rgba(35,64,142,0.08);
    }
    .card {
      padding: 2rem 1.5rem 1.5rem 1.5rem;
    }

    /* Grid de campos iniciais */
    .grid-5 {
      display: grid;
      grid-template-columns: 1fr 1fr 2fr 1fr 1fr;
      gap: 0.5rem;
      margin-bottom: 1.5rem;
    }
    .grid-5 label,
    .form-group label {
      color: var(--primary);
      font-weight: 700;
    }
    .grid-5 div {
      color: var(--primary);
      font-weight: 700;
      text-align: center;
    }
    .grid-5 input {
      width: 100%;
      padding: 0.5rem 0.4rem;
      border-radius: 6px;
      border: 1px solid var(--border);
      font-size: 1rem;
      text-align: center;
      background: #f9fafb;
      transition: border 0.2s;
      color: var(--text);
      font-weight: 600;
    }
    .grid-5 input:focus {
      border: 1.5px solid var(--primary);
      outline: none;
      background: #fff;
    }
    #fzError {
      color: var(--error);
      font-size: 0.85rem;
      margin-top: 0.15rem;
      min-height: 1.1em;
    }

    /* Desconto */
    .form-group {
      margin-bottom: 1.2rem;
    }
    .form-group input {
      width: 100%;
      padding: 0.55rem 0.5rem;
      border: 1px solid var(--border);
      border-radius: 6px;
      text-align: right;
      font-size: 1.1rem;
      background: #f9fafb;
      transition: border 0.2s;
      color: var(--text);
    }
    .form-group input:focus {
      border: 1.5px solid var(--primary);
      outline: none;
      background: #fff;
    }

    /* Resultados */
    .results {
      background: #f5f7fa;
      border-radius: 10px;
      padding: 1.2rem 1rem 1rem 1rem;
      margin-top: 1.2rem;
      box-shadow: 0 2px 8px rgba(35,64,142,0.04);
      border: 1px solid var(--border);
    }
    .results .row {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 0.7rem;
      font-size: 1.08rem;
    }
    .results .row:last-child {
      font-weight: 700;
      font-size: 1.18rem;
      color: var(--primary);
      margin-top: 0.8rem;
      margin-bottom: 0;
    }
    .results .label {
      color: var(--muted);
      font-weight: 700;
    }
    .results span {
      font-variant-numeric: tabular-nums;
      letter-spacing: 0.5px;
      color: var(--text);
    }

    /* Botão e grupo de senha */
    #btnMostrarProtegido {
      margin-top: 1rem;
      width: 100%;
      padding: 0.75rem;
      background-color: var(--accent);
      color: var(--text);
      border: none;
      border-radius: 6px;
      font-weight: 600;
      cursor: pointer;
      transition: background 0.2s;
    }
    #btnMostrarProtegido:hover {
      background: #205ab0;
    }
    #passwordGroup {
      margin-top: 1rem;
      display: flex;
      gap: 0.5rem;
      align-items: center;
    }
    #passwordGroup input {
      flex: 1;
      padding: 0.6rem;
      border: 1px solid var(--border);
      border-radius: 6px;
      font-size: 1rem;
    }
    #passwordGroup button {
      padding: 0.6rem 1rem;
      background: var(--primary);
      color: #fff;
      border: none;
      border-radius: 6px;
      font-weight: 600;
      cursor: pointer;
    }
    #senhaError {
      color: var(--error);
      font-size: 0.85rem;
      min-height: 1em;
    }

    /* Ações finais */
    .actions {
      display: flex;
      justify-content: center;
      gap: 1rem;
      margin-top: 1.2rem;
    }
    .btn-primary, .btn-secondary {
      padding: 0.7rem 1.3rem;
      border-radius: 6px;
      border: none;
      font-size: 1rem;
      font-family: inherit;
      font-weight: 600;
      cursor: pointer;
      text-decoration: none;
      text-align: center;
      transition: background 0.2s, color 0.2s;
    }
    .btn-primary {
      background: var(--primary);
      color: #fff;
    }
    .btn-primary:hover {
      background: #16306b;
    }
    .btn-secondary {
      background: #fff;
      color: var(--primary);
      border: 2px solid var(--primary);
    }
    .btn-secondary:hover {
      background: var(--primary);
      color: #fff;
    }

    /* Responsivo */
    @media (max-width: 600px) {
      .container { max-width: 98vw; margin: 0.5rem auto; }
      .header { font-size: 1.2rem; padding: 0.8rem; }
      .card { padding: 0.8rem; }
      .grid-5 { font-size: 0.9rem; gap: 0.2rem; margin-bottom: 1rem; }
      .grid-5 input { font-size: 0.85rem; padding: 0.22rem; }
      .form-group label { font-size: 0.95rem; }
      .form-group input { font-size: 0.95rem; padding: 0.22rem; }
      .results { padding: 0.5rem; font-size: 0.95rem; }
      .actions { flex-direction: column; }
      .btn-primary, .btn-secondary { width: 100%; font-size: 0.98rem; padding: 0.6rem 0; }
    }
  </style>
</head>
  <body>
    <!-- Login -->
    <div id="loginBox" style="
        max-width:320px;
        margin:60px auto;
        padding:2rem 1.5rem;
        background:#fff;
        border-radius:10px;
        box-shadow:0 2px 12px #0001;
        text-align:center;
      ">
      <h2 style="color:#23408e;margin-bottom:1rem;">Login</h2>
      <input type="text" id="user" placeholder="Usuário"
            style="width:90%;padding:8px;border-radius:5px;
                    border:1px solid #ccc;margin-bottom:0.75rem;"/><br>
      <input type="password" id="pass" placeholder="Senha"
            style="width:90%;padding:8px;border-radius:5px;
                    border:1px solid #ccc;margin-bottom:0.75rem;"/><br>
      <button onclick="login()"
              style="padding:8px 20px;border-radius:5px;
                    background:#23408e;color:#fff;border:none;
                    font-weight:600;">
        Entrar
      </button>
      <div id="loginError" style="color:#c0392b;margin-top:0.75rem;"></div>
    </div>

    <!-- Conteúdo principal -->
    <div id="mainContent" class="hidden">
      <div class="container">
        <div class="header">Calculadora De Nigris</div>
        <div class="card">

          <!-- campos iniciais -->
          <div class="grid-5">
            <div>Modelo<br><strong id="modelo">–</strong></div>
            <div>UP<br><strong id="up">–</strong></div>
            <div>
              <label for="fz">FZ</label>
              <input type="text" id="fz" maxlength="6" placeholder="123456"/>
              <div id="fzError"></div>
            </div>
            <div>Ano/Mod<br><strong id="anoMod">–</strong></div>
            <div>Valor Tabela<br><strong id="valorTabela">R$ 0,00</strong></div>
          </div>

          <!-- desconto -->
          <div class="form-group">
            <label for="desconto">Desconto (%)</label>
            <input type="number" id="desconto" value="0" min="0" max="3" step="0.5"/>
          </div>

          <!-- resultados -->
          <div class="results">
            <div class="row">
              <span class="label">Desconto (R$)</span>
              <span id="descontoReais">R$ 0,00</span>
            </div>
            <div class="row">
              <span class="label">Valor de Venda</span>
              <span id="valorVenda">R$ 0,00</span>
            </div>

            <!-- Linhas protegidas -->
            <div class="row hidden" id="rowComissaoProtected">
              <span class="label">Comissão </span>
              <span id="comissaoProtected">R$ 0,00</span>
            </div>
            <div class="row hidden" id="rowDsrProtected">
              <span class="label">DSR</span>
              <span id="dsrProtected">R$ 0,00</span>
            </div>

            <div class="row">
              <span class="label">Total</span>
              <span id="total">R$ 0,00</span>
            </div>
          </div>

          <!-- botão para liberar/ocultar Comissão e DSR -->
          <button id="btnMostrarProtegido">Mostrar Comissão e DSR</button>

          <!-- grupo de senha -->
          <div id="passwordGroup" class="hidden">
            <input type="password" id="senhaInput" placeholder="Digite a senha"/>
            <button id="btnVerificarSenha">Confirmar</button>
            <div id="senhaError" style="color: var(--error);font-size:0.85rem;"></div>
          </div>

          <!-- ações finais -->
          <div class="actions">
            <a href="https://gd.cimbb.com.br/p/crm/atividades/agenda/"
              target="_blank" class="btn-primary">
              Emitir Pedido
            </a>
            <a href="https://wa.me/5511950583053"
              target="_blank" class="btn-secondary">
              Solicitar Reserva
            </a>
          </div>

        </div>
      </div>
    </div>
  </body>

  <script>
    window.addEventListener("DOMContentLoaded", () => {
      // Função de login
      function login() {
        const u = document.getElementById("user").value;
        const p = document.getElementById("pass").value;
        if (u === "Luciano" && p === "Dn@1234") {
          document.getElementById("loginBox").classList.add("hidden");
          document.getElementById("mainContent").classList.remove("hidden");
        } else {
          document.getElementById("loginError").innerText = "Usuário ou senha inválidos";
        }
      }

      // Referências aos elementos
      const fzEl              = document.getElementById("fz");
      const fzErrorEl         = document.getElementById("fzError");
      const modeloEl          = document.getElementById("modelo");
      const upEl              = document.getElementById("up");
      const anoModEl          = document.getElementById("anoMod");
      const valorTabelaEl     = document.getElementById("valorTabela");
      const descontoEl        = document.getElementById("desconto");
      const descontoReaisEl   = document.getElementById("descontoReais");
      const valorVendaEl      = document.getElementById("valorVenda");
      const lucroBrutoEl      = document.getElementById("lucroBruto");
      const comissaoEl        = document.getElementById("comissaoProtected");
      const dsrEl             = document.getElementById("dsrProtected");
      const totalEl           = document.getElementById("total");
      const rowCom            = document.getElementById("rowComissaoProtected");
      const rowDsr            = document.getElementById("rowDsrProtected");
      const btnMost           = document.getElementById("btnMostrarProtegido");
      const pwdGrp            = document.getElementById("passwordGroup");
      const pwdIn             = document.getElementById("senhaInput");
      const btnVer            = document.getElementById("btnVerificarSenha");
      const pwdErr            = document.getElementById("senhaError");
      const btnLogin          = document.getElementById("btnLogin");

      let valorTabela = 0;
      let vendedorAtual = null;
      const vendedores = {};

      function formatar(v) {
        return v.toLocaleString("pt-BR", { style: "currency", currency: "BRL" });
      }

      function atualizarValores() {
        let d = parseFloat(descontoEl.value) || 0;
        if (d > 3) { alert("Desconto máximo de 3%"); d = 3; descontoEl.value = 3; }
        const valorDesc = valorTabela * (d / 100);
        const valorVenda = valorTabela - valorDesc;

        let lucroBruto = 0, comissao = 0, dsr = 0, total = 0;

        if (vendedorAtual) {
          const receitaEfetiva = valorVenda - (valorVenda * 0.12);
          const custoEfetivo = (vendedorAtual.valorCompra || 0) - ((vendedorAtual.valorCompra || 0) * 0.12);
          lucroBruto =
            (receitaEfetiva - custoEfetivo)
            + (vendedorAtual.fundoEstrela || 0)
            + (vendedorAtual.retirada || 0)
            + (vendedorAtual.programacao || 0)
            - (vendedorAtual.frete || 0)
            - (vendedorAtual.revisao || 0)
            - (vendedorAtual.custosAdd || 0);

          comissao = lucroBruto * 0.09;
          dsr = comissao * 0.15;
          total = comissao + dsr;
        }

        descontoReaisEl.innerText = formatar(valorDesc);
        valorVendaEl.innerText    = formatar(valorVenda);
        lucroBrutoEl.innerText    = formatar(lucroBruto);
        comissaoEl.innerText      = formatar(comissao);
        dsrEl.innerText           = formatar(dsr);
        totalEl.innerText         = formatar(total);
      }

      const sheetCsvUrl =
        "https://docs.google.com/spreadsheets/d/e/2PACX-1vQeqk-5eBeAxB4GesiaM7W6iEUq9lgfTsRzdy1QylG1ak7dX35Ol827EM1c7LPWb97BoBh6iUbtJMMw"
        + "/pub?gid=2122951741&single=true&output=csv";

      async function carregarDados() {
        try {
          const res = await fetch(sheetCsvUrl);
          const txt = await res.text();
          txt.trim().split("\n").slice(1).forEach(line => {
            const cols = line
              .split(/,(?=(?:(?:[^"]*"){2})*[^"]*$)/)
              .map(c => c.replace(/^"|"$/g, "").trim());
            const fzKey = cols[0].padStart(6, "0");
            vendedores[fzKey] = {
              modelo: cols[1],
              up:     cols[2],
              anoMod: cols[3],
              valorTabela: parseFloat(cols[4].replace(/\./g, "").replace(/,/g, ".")),
              valorCompra: parseFloat(cols[5].replace(/\./g, "").replace(/,/g, ".")),
              fundoEstrela: parseFloat(cols[6].replace(/\./g, "").replace(/,/g, ".")),
              retirada: parseFloat(cols[7].replace(/\./g, "").replace(/,/g, ".")),
              programacao: parseFloat(cols[8].replace(/\./g, "").replace(/,/g, ".")),
              frete: parseFloat(cols[9].replace(/\./g, "").replace(/,/g, ".")),
              revisao: parseFloat(cols[10].replace(/\./g, "").replace(/,/g, ".")),
              custosAdd: parseFloat(cols[11].replace(/\./g, "").replace(/,/g, "."))
            };
          });
        } catch (err) {
          console.error("Erro ao carregar CSV:", err);
        }
      }

      fzEl.addEventListener("input", () => {
        const raw = fzEl.value.replace(/\D/g, "").slice(0, 6);
        fzEl.value = raw;
        const key = raw.padStart(6, "0");

        if (vendedores[key]) {
          vendedorAtual = vendedores[key];
          modeloEl.innerText     = vendedorAtual.modelo;
          upEl.innerText         = vendedorAtual.up;
          anoModEl.innerText     = vendedorAtual.anoMod;
          valorTabela            = vendedorAtual.valorTabela;
          valorTabelaEl.innerText = formatar(valorTabela);
          fzErrorEl.innerText    = "";
          atualizarValores();
        } else {
          modeloEl.innerText     = "–";
          upEl.innerText         = "–";
          anoModEl.innerText     = "–";
          valorTabelaEl.innerText = "R$ 0,00";
          fzErrorEl.innerText    = "FZ não encontrado";
          vendedorAtual          = null;
          atualizarValores();
        }
      });

      descontoEl.addEventListener("input", atualizarValores);

      btnMost.addEventListener("click", () => {
        pwdGrp.classList.remove("hidden");
      });

      btnVer.addEventListener("click", () => {
        if (pwdIn.value === "Luciano@321") {
          rowCom.classList.remove("hidden");
          rowDsr.classList.remove("hidden");
          pwdErr.innerText = "";
        } else {
          pwdErr.innerText = "Senha incorreta";
        }
      });

      btnLogin.addEventListener("click", login);

      carregarDados();
      });
  </script>
</body>
</html>