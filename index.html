<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Calculadora De Nigris</title>
  <link rel="icon" type="image/png" href="Imagens/icon.png"/>
  <link rel="stylesheet" href="style.css">
  
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
</head>

<body>

  <div id="loading" class="loading-overlay">
    <div class="loading-spinner"></div>
    <p>Carregando dados...</p>
  </div>

  <header class="main-header">
    <div class="header-container">
      <div class="logo-area">
        <a href="home.html" class="logo-link">
          <img src="Imagens/Mercedes-Logo.png" alt="Mercedes-Benz Logo" class="brand-logo">
          <span class="divider-vertical"></span>
          <img src="Imagens/Logo_De Nigris Branco.png" alt="De Nigris Logo" class="dealer-logo">
        </a>
      </div>

      <button class="nav-toggle" aria-label="Menu">
        <span class="bar"></span>
        <span class="bar"></span>
        <span class="bar"></span>
      </button>

      <nav class="nav-menu">
        <a href="home.html" class="nav-item">Home</a>
        <a href="index.html" class="nav-item active">Calculadora</a>
        <a href="estoque.html" class="nav-item">Estoque</a>
      </nav>
    </div>
  </header>
  
  <div class="header-space"></div>

  <main id="mainContent" class="main-wrapper">

    <div class="tabs-container">
      <button id="btnEstoqueProprio" class="tab-btn active">Estoque De Nigris</button>
      <button id="btnEstoqueFabrica" class="tab-btn">Estoque F√°brica</button>
    </div>

    <section id="calcEstoqueProprio" class="calc-section">
      <div class="container-width">
        
        <div class="card glass-effect">
          <div class="card-header">
            <h2>Calculadora De Nigris</h2>
            <span class="status-badge">Pronta Entrega</span>
          </div>

          <div class="card-body">
            
          <div class="vehicle-dashboard">
            <div class="vehicle-info">
              <div class="info-item">
                <span class="info-label">Modelo</span>
                <strong id="modelo" class="info-value">‚Äì</strong>
              </div>
              <div class="info-item">
                <span class="info-label">UP</span>
                <strong id="up" class="info-value">‚Äì</strong>
              </div>
              <div class="info-item">
                <span class="info-label">Ano/Mod</span>
                <strong id="anoMod" class="info-value">‚Äì</strong>
              </div>
            </div>

            <div id="obs-container" style="display: none; margin: 10px 0; text-align: center; color: #d9534f; font-size: 0.9rem;">
                <strong>Observa√ß√£o: </strong> <span id="obs-texto"></span>
            </div>
            <div class="fz-wrapper">
              <label for="fz" class="input-label">FZ / Chassi</label>
              <div class="input-group">
                <input type="text" id="fz" class="form-input" maxlength="6" placeholder="Ex: 123456"/>
                <span class="input-icon">üîç</span>
              </div>
              <div id="fzError" class="error-msg"></div>
            </div>
              
              <div class="action-buttons-mini">
                <button type="button" id="btnVerFoto" class="btn-icon" class="btn-icon photo" title="Ver foto">
                  <svg viewBox="0 0 24 24" aria-hidden="true">
                    <path d="M21 5h-3.2l-1.8-2H8L6.2 5H3c-1.1 0-2 .9-2 2v11c0 1.1.9 2 2 2h18c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm-9 13a4 4 0 1 1 0-8 4 4 0 0 1 0 8z"/>
                  </svg>
                </button>

                <button type="button" id="btnVerInfo" class="btn-icon" class="btn-icon info" title="Mais informa√ß√µes">
                  <svg viewBox="0 0 24 24" aria-hidden="true">
                    <path d="M11 7h2V9h-2zm0 4h2v6h-2zm1-9C6.93 2 3 5.93 3 11s3.93 9 9 9 9-3.93 9-9-3.93-9-9-9z"/>
                  </svg>
                </button>
              </div>

              <div class="price-hero">
                <span class="label">Valor de Tabela</span>
                <strong id="valorTabela" class="hero-value">R$ 0,00</strong>
              </div>
            </div>

            <hr class="divider">

            <div class="form-section">
              <div class="form-section"> <div class="form-group full-width">
                  <label for="tipoPreco">Tabela de Pre√ßo</label>
                  <div class="select-wrapper">
                    <select id="tipoPreco" class="form-select">
                      <option value="vendedor">Vendedor</option>
                      <option value="gerente">Gerente</option>
                      <option value="oportunidade">Oportunidade</option>
                      <option value="especial">Especial (Manual)</option>
                    </select>
                  </div>
                </div>

                <div id="especialWrapper" class="hidden">
                  <label for="precoEspecial">Valor Negociado</label>
                  <div class="input-money-group">
                    <span class="currency-symbol">R$</span>
                    <input type="text" inputmode="decimal" id="precoEspecial" placeholder="0,00" />
                  </div>
                  <span id="minEspecialValor">M√≠nimo sugerido: R$ --</span>
                </div>
              </div>

              <div id="infoVeiculo" class="vehicle-details hidden">
                <ul class="details-list">
                  <li><strong>Cor:</strong> <span id="infoCor">‚Äì</span></li>
                  <li><strong>Variante:</strong> <span id="infoVariante">‚Äì</span></li>
                  <li><strong>P√°tio:</strong> <span id="infoPatio">‚Äì</span></li>
                </ul>
              </div>
            </div>

            <div class="results-container">
              <div class="result-row">
                <span class="result-label">Desconto Aplicado</span>
                <span id="descontoReais" class="result-value discount">R$ 0,00</span>
              </div>
              <div class="result-row highlight">
                <span class="result-label">Valor de Venda</span>
                <span id="valorVenda" class="result-value final">R$ 0,00</span>
              </div>

              <div class="protected-data">
                <div class="row hidden" id="rowComissaoProtected">
                  <span>Comiss√£o</span> <span id="comissaoProtected">R$ 0,00</span>
                </div>
                <div class="row hidden" id="rowDsrProtected">
                  <span>DSR ~</span> <span id="dsrProtected">R$ 0,00</span>
                </div>
                <div class="row hidden" id="rowTotalProtected">
                  <span>Total</span> <span id="total">R$ 0,00</span>
                </div>
              </div>
            </div>

            <button id="btnMostrarProtegido" class="btn-premium btn-detail">
              <span class="icon"></span> Ver Detalhamento
            </button>

            <div id="passwordGroup" class="password-wrapper hidden">
              <div class="password-box">
                <input type="password" id="senhaInput" placeholder="Senha do Gestor" />
                <button id="btnVerificarSenha">OK</button>
              </div>
              <div id="senhaError" class="error-msg"></div>
            </div>

            <div class="action-footer">
              <a id="linkEmitirPedido" href="https://gd.cimbb.com.br/p/crm/atividades/agenda/" target="_blank" class="btn-premium btn-order">
                <span class="icon"></span> Emitir Pedido
              </a>

              <button type="button" id="btnOpenReserva" class="btn-premium btn-whatsapp">
                <span class="icon"></span> Solicitar Reserva
              </button>

              <div id="modalReserva" class="modal-overlay hidden">
                <div class="modal-card">
                  <div class="modal-header">
                    <h3>Nova Solicita√ß√£o</h3>
                    <button class="btn-close-modal" id="btnCloseReserva">√ó</button>
                  </div>
                  
                  <div class="modal-body">
                    <p class="modal-subtitle">Preencha para gerar a mensagem de reserva.</p>
                    
                    <div class="reserva-summary">
                      <span id="resumoModelo">Modelo: --</span>
                      <span id="resumoFZ">FZ: --</span>
                    </div>

                    <div class="form-group">
                      <label>Nome do Vendedor</label>
                      <input type="text" id="reservaNome" class="form-input" placeholder="Seu nome">
                    </div>

                    <div class="form-group">
                      <label>N√∫mero do Pedido / Proposta</label>
                      <input type="text" id="reservaPedido" class="form-input" placeholder="Ex: 12345">
                    </div>

                    <div class="form-group">
                      <label>Anexar Pedido (PDF/Foto)</label>
                      <div class="file-upload-wrapper">
                        <input type="file" id="reservaArquivo" class="form-input-file">
                        <p class="file-hint">‚ö†Ô∏è O arquivo deve ser arrastado para a conversa do WhatsApp ap√≥s clicar em enviar.</p>
                      </div>
                    </div>

                    <button id="btnEnviarWhatsApp" class="btn-premium btn-primary full-width">
                      Enviar no WhatsApp
                    </button>
                  </div>
                </div>
              </div>

          </div> </div> </div>
    </section>

    <section id="calcEstoqueFabrica" class="calc-section hidden fabrica-theme">
      <div class="container-width">
        <div class="card">
          <div class="card-header factory">
            <h2>Estoque F√°brica</h2>
            <span class="status-badge gray">Simula√ß√£o</span>
          </div>
          
          <div class="card-body">
            
            <div class="form-grid">
              <div class="form-group">
                <label for="anoModeloFab">Ano/Modelo</label>
                <div class="select-wrapper">
                  <select id="anoModeloFab" class="form-select">
                    <option value="">Selecione</option>
                    <option value="25/25">25/25</option>
                    <option value="25/26">25/26</option>
                    <option value="26/26">26/26</option>
                  </select>
                </div>
              </div>

              <div class="form-group full-width">
                <label>Fam√≠lia</label>
                <div id="familiaFab" class="radio-group-modern">
                  <label class="radio-btn"><input type="radio" name="familiaFab" value="Accelo"><span>Accelo</span></label>
                  <label class="radio-btn"><input type="radio" name="familiaFab" value="Atego"><span>Atego</span></label>
                  <label class="radio-btn"><input type="radio" name="familiaFab" value="Actros"><span>Actros</span></label>
                  <label class="radio-btn"><input type="radio" name="familiaFab" value="Axor"><span>Axor</span></label>
                  <label class="radio-btn"><input type="radio" name="familiaFab" value="Arocs"><span>Arocs</span></label>
                </div>
              </div>

              <div class="form-group">
                <label for="upFab">UP</label>
                <div class="select-wrapper">
                  <select id="upFab" class="form-select"></select>
                </div>
              </div>

              <div class="form-group">
                 <label>Variante</label>
                 <div class="variant-display-box">
                    <div id="varianteFab" class="variant-text">--</div>
                    <button id="btnCopiarVariante" class="btn-copy" title="Copiar">
                      <svg id="iconCopiarVariante" width="16" height="16" fill="currentColor" viewBox="0 0 16 16"><path d="M10 1.5A1.5 1.5 0 0 1 11.5 3v1h-1V3a.5.5 0 0 0-.5-.5h-7A.5.5 0 0 0 2 3v10a.5.5 0 0 0 .5.5H6v1H2.5A1.5 1.5 0 0 1 1 13.5v-10A1.5 1.5 0 0 1 2.5 2h7zm1 3A1.5 1.5 0 0 1 12.5 6v7A1.5 1.5 0 0 1 11 14.5h-5A1.5 1.5 0 0 1 4.5 13V6A1.5 1.5 0 0 1 6 4.5h5zm-5 1A.5.5 0 0 0 6 6v7a.5.5 0 0 0 .5.5h5a.5.5 0 0 0 .5-.5V6a.5.5 0 0 0-.5-.5h-5z"/></svg>
                      <svg id="iconCheckVariante" width="16" height="16" fill="currentColor" viewBox="0 0 16 16" style="display:none;"><path d="M13.485 1.929a1 1 0 0 1 1.415 1.414l-8 8a1 1 0 0 1-1.415 0l-4-4A1 1 0 1 1 2.9 5.929l3.293 3.293 7.293-7.293z"/></svg>
                    </button>
                 </div>
              </div>

                <div class="form-group full-width model-wrapper">
                  <label for="modeloFab">Descri√ß√£o Comercial</label>
                  
                  <div class="input-with-action">
                    <div class="select-wrapper">
                      <select id="modeloFab" class="form-select">
                        </select>
                    </div>
                    
                    <a href="https://truckinfomb.com.br/variantes" target="_blank" class="truck-link" title="Ver no TruckInfo">
                      <img src="Imagens/truckinfo.png" alt="Truck Info">
                    </a>
                  </div>
                </div>
                  <div class="form-group full-width">

                    <label for="acaoFab">Condi√ß√£o Comercial</label>

                    <div class="select-wrapper">

                      <select id="acaoFab" class="form-select">

                        <option value="">Selecione a Campanha</option>

                        <option value="Estoque">Estoque</option>

                        <option value="C.E.ABAST">C.E.ABAST</option>

                        <option value="Frigorificado">Frigorificado</option>

                        <option value="Postos de Combustiveis">Postos de Combustiveis</option>

                        <option value="Mais Alimentos">Mais Alimentos</option>

                      </select>

                    </div>

                  </div>
                    </div>
            </div>
              <div class="result-card-factory">
                <div class="result-grid">
                  <div class="result-item">
                    <span class="label">Valor Tabela</span>
                    <span id="faValorTabela" class="value">R$ 0,00</span>
                  </div>
                  <div class="result-item highlight">
                    <span class="label">Valor Venda</span>
                    <span id="faValorVenda" class="value">R$ 0,00</span>
                  </div>
                  <div class="result-item">
                    <span class="label">Desconto</span>
                    <span id="faDescontoPerc" class="value discount">0%</span>
                  </div>
                </div>
                <button id="btnDetalhamentoFab" class="btn-outline-secondary full-width mt-3">
                  Ver Detalhamento Completo
                </button>
              </div>

            </div></div></div>
    </section>

  </main>

  <script type="module">
    import { requireAuth } from './auth.js'
    await requireAuth('estoque.html')
  </script>
  
  <script>
    // Script b√°sico do menu (mantido)
    const toggle = document.querySelector('.nav-toggle');
    const nav = document.querySelector('.nav-menu');

    toggle.addEventListener('click', () => {
      nav.classList.toggle('open');
      toggle.classList.toggle('active'); // adiciona classe para anima√ß√£o do √≠cone se quiser
    });
  </script>
  <script src="script.js"></script>

</body>
</html>